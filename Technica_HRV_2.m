
heart_rate_data=[-3.3521e-006,-0.00078597,-0.01444,-0.069323,-0.13504,-0.13201, -0.11715,-0.18003,-0.19048,-0.1092,-0.13844,-0.19835,-0.13095,-0.11182,-0.16376,- 0.12906, -0.081186,-0.13302,-0.14731,-0.085075,-0.12198,-0.16608,-0.097208,- 0.096487,-0.16829, -0.11396,-0.071979,-0.16063,-0.14684,-0.048945,- 0.083339,-0.11158,0.011667, 0.050128, 0.017387,0.087601,0.099052,0.033043,0.055315,0.11767,0.075126,0.00092971,-0.0066405, -0.016547,-0.039243,-0.0017631,0.0014236,-0.11669,-0.15701,-0.097203,-0.16523, -0.22374, -0.13687,-0.13928,-0.19477,-0.13843,-0.10777,-0.16704,-0.15722,-0.15078,-0.25347,-0.21894, 0.12456,0.63318,1.3865,2.338,2.707,2.1455,1.0973,0.19961,- 0.47019,-0.91259,-0.88259,-0.7607, -0.71554,-0.5154,-0.3101,-0.21767,- 0.10917,0.017239,0.009699,-0.027035,0.059993, 0.051329,- 0.013513,0.060047,0.092538,0.026493,0.048626, 0.11683,0.068182,0.016884,0.077782, 0.077782,0.090676,0.046846,0.092566,0.13618,0.10997,0.13734,0.20043,0.19478,0.19395, .28779,0.3444,0.35288,0.45451,0.54366,0.52055,0.5846,0.70123,0.66845,0.64716,0.7188,0 .70188,0.63048,0.64335,0.64998,0.53268,0.4599,0.44727,0.31589,0.22536,0.2468,0.16227, 0.066743,0.089265,0.051448,-0.039128,-3.3521e-006,-0.00078597,-0.01444,-0.069323,-0.13504,-0.13201, -0.11715,-0.18003,-0.19048,-0.1092,-0.13844,-0.19835,-0.13095,-0.11182,-0.16376,- 0.12906, -0.081186,-0.13302,-0.14731,-0.085075,-0.12198,-0.16608,-0.097208,- 0.096487,-0.16829, -0.11396,-0.071979,-0.16063,-0.14684,-0.048945,- 0.083339,-0.11158,0.011667, 0.050128, 0.017387,0.087601,0.099052,0.033043,0.055315,0.11767,0.075126,0.00092971,-0.0066405, -0.016547,-0.039243,-0.0017631,0.0014236,-0.11669,-0.15701,-0.097203,-0.16523, -0.22374, -0.13687,-0.13928,-0.19477,-0.13843,-0.10777,-0.16704,-0.15722,-0.15078,-0.25347,-0.21894, 0.12456,0.63318,1.3865,2.338,2.707,2.1455,1.0973,0.19961,- 0.47019,-0.91259,-0.88259,-0.7607, -0.71554,-0.5154,-0.3101,-0.21767,- 0.10917,0.017239,0.009699,-0.027035,0.059993, 0.051329,- 0.013513,0.060047,0.092538,0.026493,0.048626, 0.11683,0.068182,0.016884,0.077782, 0.077782,0.090676,0.046846,0.092566,0.13618,0.10997,0.13734,0.20043,0.19478,0.19395, .28779,0.3444,0.35288,0.45451,0.54366,0.52055,0.5846,0.70123,0.66845,0.64716,0.7188,0 .70188,0.63048,0.64335,0.64998,0.53268,0.4599,0.44727,0.31589,0.22536,0.2468,0.16227, 0.066743,0.089265,0.051448,-0.039128  -3.3521e-006,-0.00078597,-0.01444,-0.069323,-0.13504,-0.13201, -0.11715,-0.18003,-0.19048,-0.1092,-0.13844,-0.19835,-0.13095,-0.11182,-0.16376,- 0.12906, -0.081186,-0.13302,-0.14731,-0.085075,-0.12198,-0.16608,-0.097208,- 0.096487,-0.16829, -0.11396,-0.071979,-0.16063,-0.14684,-0.048945,- 0.083339,-0.11158,0.011667, 0.050128, 0.017387,0.087601,0.099052,0.033043,0.055315,0.11767,0.075126,0.00092971,-0.0066405, -0.016547,-0.039243,-0.0017631,0.0014236,-0.11669,-0.15701,-0.097203,-0.16523, -0.22374, -0.13687,-0.13928,-0.19477,-0.13843,-0.10777,-0.16704,-0.15722,-0.15078,-0.25347,-0.21894, 0.12456,0.63318,1.3865,2.338,2.707,2.1455,1.0973,0.19961,- 0.47019,-0.91259,-0.88259,-0.7607, -0.71554,-0.5154,-0.3101,-0.21767,- 0.10917,0.017239,0.009699,-0.027035,0.059993, 0.051329,- 0.013513,0.060047,0.092538,0.026493,0.048626, 0.11683,0.068182,0.016884,0.077782, 0.077782,0.090676,0.046846,0.092566,0.13618,0.10997,0.13734,0.20043,0.19478,0.19395, .28779,0.3444,0.35288,0.45451,0.54366,0.52055,0.5846,0.70123,0.66845,0.64716,0.7188,0 .70188,0.63048,0.64335,0.64998,0.53268,0.4599,0.44727,0.31589,0.22536,0.2468,0.16227, 0.066743,0.089265,0.051448,-0.039128,-3.3521e-006,-0.00078597,-0.01444,-0.069323,-0.13504,-0.13201, -0.11715,-0.18003,-0.19048,-0.1092,-0.13844,-0.19835,-0.13095,-0.11182,-0.16376,- 0.12906, -0.081186,-0.13302,-0.14731,-0.085075,-0.12198,-0.16608,-0.097208,- 0.096487,-0.16829, -0.11396,-0.071979,-0.16063,-0.14684,-0.048945,- 0.083339,-0.11158,0.011667, 0.050128, 0.017387,0.087601,0.099052,0.033043,0.055315,0.11767,0.075126,0.00092971,-0.0066405, -0.016547,-0.039243,-0.0017631,0.0014236,-0.11669,-0.15701,-0.097203,-0.16523, -0.22374, -0.13687,-0.13928,-0.19477,-0.13843,-0.10777,-0.16704,-0.15722,-0.15078,-0.25347,-0.21894, 0.12456,0.63318,1.3865,2.338,2.707,2.1455,1.0973,0.19961,- 0.47019,-0.91259,-0.88259,-0.7607, -0.71554,-0.5154,-0.3101,-0.21767,- 0.10917,0.017239,0.009699,-0.027035,0.059993, 0.051329,- 0.013513,0.060047,0.092538,0.026493,0.048626, 0.11683,0.068182,0.016884,0.077782, 0.077782,0.090676,0.046846,0.092566,0.13618,0.10997,0.13734,0.20043,0.19478,0.19395, .28779,0.3444,0.35288,0.45451,0.54366,0.52055,0.5846,0.70123,0.66845,0.64716,0.7188,0 .70188,0.63048,0.64335,0.64998,0.53268,0.4599,0.44727,0.31589,0.22536,0.2468,0.16227, 0.066743,0.089265,0.051448,-0.039128  -3.3521e-006,-0.00078597,-0.01444,-0.069323,-0.13504,-0.13201, -0.11715,-0.18003,-0.19048,-0.1092,-0.13844,-0.19835,-0.13095,-0.11182,-0.16376,- 0.12906, -0.081186,-0.13302,-0.14731,-0.085075,-0.12198,-0.16608,-0.097208,- 0.096487,-0.16829, -0.11396,-0.071979,-0.16063,-0.14684,-0.048945,- 0.083339,-0.11158,0.011667, 0.050128, 0.017387,0.087601,0.099052,0.033043,0.055315,0.11767,0.075126,0.00092971,-0.0066405, -0.016547,-0.039243,-0.0017631,0.0014236,-0.11669,-0.15701,-0.097203,-0.16523, -0.22374, -0.13687,-0.13928,-0.19477,-0.13843,-0.10777,-0.16704,-0.15722,-0.15078,-0.25347,-0.21894, 0.12456,0.63318,1.3865,2.338,2.707,2.1455,1.0973,0.19961,- 0.47019,-0.91259,-0.88259,-0.7607, -0.71554,-0.5154,-0.3101,-0.21767,- 0.10917,0.017239,0.009699,-0.027035,0.059993, 0.051329,- 0.013513,0.060047,0.092538,0.026493,0.048626, 0.11683,0.068182,0.016884,0.077782, 0.077782,0.090676,0.046846,0.092566,0.13618,0.10997,0.13734,0.20043,0.19478,0.19395, .28779,0.3444,0.35288,0.45451,0.54366,0.52055,0.5846,0.70123,0.66845,0.64716,0.7188,0 .70188,0.63048,0.64335,0.64998,0.53268,0.4599,0.44727,0.31589,0.22536,0.2468,0.16227, 0.066743,0.089265,0.051448,-0.039128,-3.3521e-006,-0.00078597,-0.01444,-0.069323,-0.13504,-0.13201, -0.11715,-0.18003,-0.19048,-0.1092,-0.13844,-0.19835,-0.13095,-0.11182,-0.16376,- 0.12906, -0.081186,-0.13302,-0.14731,-0.085075,-0.12198,-0.16608,-0.097208,- 0.096487,-0.16829, -0.11396,-0.071979,-0.16063,-0.14684,-0.048945,- 0.083339,-0.11158,0.011667, 0.050128, 0.017387,0.087601,0.099052,0.033043,0.055315,0.11767,0.075126,0.00092971,-0.0066405, -0.016547,-0.039243,-0.0017631,0.0014236,-0.11669,-0.15701,-0.097203,-0.16523, -0.22374, -0.13687,-0.13928,-0.19477,-0.13843,-0.10777,-0.16704,-0.15722,-0.15078,-0.25347,-0.21894, 0.12456,0.63318,1.3865,2.338,2.707,2.1455,1.0973,0.19961,- 0.47019,-0.91259,-0.88259,-0.7607, -0.71554,-0.5154,-0.3101,-0.21767,- 0.10917,0.017239,0.009699,-0.027035,0.059993, 0.051329,- 0.013513,0.060047,0.092538,0.026493,0.048626, 0.11683,0.068182,0.016884,0.077782, 0.077782,0.090676,0.046846,0.092566,0.13618,0.10997,0.13734,0.20043,0.19478,0.19395, .28779,0.3444,0.35288,0.45451,0.54366,0.52055,0.5846,0.70123,0.66845,0.64716,0.7188,0 .70188,0.63048,0.64335,0.64998,0.53268,0.4599,0.44727,0.31589,0.22536,0.2468,0.16227, 0.066743,0.089265,0.051448,-0.039128  -3.3521e-006,-0.00078597,-0.01444,-0.069323,-0.13504,-0.13201, -0.11715,-0.18003,-0.19048,-0.1092,-0.13844,-0.19835,-0.13095,-0.11182,-0.16376,- 0.12906, -0.081186,-0.13302,-0.14731,-0.085075,-0.12198,-0.16608,-0.097208,- 0.096487,-0.16829, -0.11396,-0.071979,-0.16063,-0.14684,-0.048945,- 0.083339,-0.11158,0.011667, 0.050128, 0.017387,0.087601,0.099052,0.033043,0.055315,0.11767,0.075126,0.00092971,-0.0066405, -0.016547,-0.039243,-0.0017631,0.0014236,-0.11669,-0.15701,-0.097203,-0.16523, -0.22374, -0.13687,-0.13928,-0.19477,-0.13843,-0.10777,-0.16704,-0.15722,-0.15078,-0.25347,-0.21894, 0.12456,0.63318,1.3865,2.338,2.707,2.1455,1.0973,0.19961,- 0.47019,-0.91259,-0.88259,-0.7607, -0.71554,-0.5154,-0.3101,-0.21767,- 0.10917,0.017239,0.009699,-0.027035,0.059993, 0.051329,- 0.013513,0.060047,0.092538,0.026493,0.048626, 0.11683,0.068182,0.016884,0.077782, 0.077782,0.090676,0.046846,0.092566,0.13618,0.10997,0.13734,0.20043,0.19478,0.19395, .28779,0.3444,0.35288,0.45451,0.54366,0.52055,0.5846,0.70123,0.66845,0.64716,0.7188,0 .70188,0.63048,0.64335,0.64998,0.53268,0.4599,0.44727,0.31589,0.22536,0.2468,0.16227, 0.066743,0.089265,0.051448,-0.039128,-3.3521e-006,-0.00078597,-0.01444,-0.069323,-0.13504,-0.13201, -0.11715,-0.18003,-0.19048,-0.1092,-0.13844,-0.19835,-0.13095,-0.11182,-0.16376,- 0.12906, -0.081186,-0.13302,-0.14731,-0.085075,-0.12198,-0.16608,-0.097208,- 0.096487,-0.16829, -0.11396,-0.071979,-0.16063,-0.14684,-0.048945,- 0.083339,-0.11158,0.011667, 0.050128, 0.017387,0.087601,0.099052,0.033043,0.055315,0.11767,0.075126,0.00092971,-0.0066405, -0.016547,-0.039243,-0.0017631,0.0014236,-0.11669,-0.15701,-0.097203,-0.16523, -0.22374, -0.13687,-0.13928,-0.19477,-0.13843,-0.10777,-0.16704,-0.15722,-0.15078,-0.25347,-0.21894, 0.12456,0.63318,1.3865,2.338,2.707,2.1455,1.0973,0.19961,- 0.47019,-0.91259,-0.88259,-0.7607, -0.71554,-0.5154,-0.3101,-0.21767,- 0.10917,0.017239,0.009699,-0.027035,0.059993, 0.051329,- 0.013513,0.060047,0.092538,0.026493,0.048626, 0.11683,0.068182,0.016884,0.077782, 0.077782,0.090676,0.046846,0.092566,0.13618,0.10997,0.13734,0.20043,0.19478,0.19395, .28779,0.3444,0.35288,0.45451,0.54366,0.52055,0.5846,0.70123,0.66845,0.64716,0.7188,0 .70188,0.63048,0.64335,0.64998,0.53268,0.4599,0.44727,0.31589,0.22536,0.2468,0.16227, 0.066743,0.089265,0.051448,-0.039128];


% Sampling frequency (Hz)
fs = 125; % Sample frequency in Hz

% Define frequency bands
f_vlf = [0.0033 0.04]; % Very low frequency band (Hz)
f_lf = [0.04 0.15];     % Low frequency band (Hz)
f_hf = [0.15 0.4];      % High frequency band (Hz)

% Compute Lomb-Scargle periodogram
[freq, power] = plomb(heart_rate_data, 1/fs);

% Compute power spectrum density (PSD)
psd = power / (0.5 * length(heart_rate_data));

% Compute indices for frequency bands
ind_vlf = find(freq >= f_vlf(1) & freq <= f_vlf(2));
ind_lf = find(freq >= f_lf(1) & freq <= f_lf(2));
ind_hf = find(freq >= f_hf(1) & freq <= f_hf(2));

% Compute VLF, LF, and HF components
VLF = trapz(psd(ind_vlf));
LF = trapz(psd(ind_lf));
HF = trapz(psd(ind_hf));

% Display results
disp(['VLF Power: ', num2str(VLF)]);
disp(['LF Power: ', num2str(LF)]);
disp(['HF Power: ', num2str(HF)]);


dataField1 = [ VLF];
dataField2  =[LF];
dataField3 = [HF];
tStamps = [datetime('now')-minutes(9):minutes(1):datetime('now')]';
dataTable = timetable(tStamps,dataField1,dataField2,dataField3);
channelID = 2470870;
writeKey  = 'OPZK8BMT9QWZ0YKI';
response = thingSpeakWrite(channelID,VLF,'WriteKey',writeKey);